{% extends 'layouts/base.html' %}

{% block title %}Mon Espace Patient{% endblock %}

{% block content %}
<h1 class="mb-4">Bienvenue, {{ current_user.prenom }} !</h1>
<p class="lead">Gérez ici vos informations et vos rendez-vous.</p>

<div class="row g-4">
    <div class="col-md-5">
        <div class="card shadow-sm p-4 h-100">
            <h4 class="card-title text-primary">Mon Dossier (Simplifié)</h4>
            <p><strong>Nom:</strong> {{ current_user.nom }}</p>
            <p><strong>Prénom:</strong> {{ current_user.prenom }}</p>
            <p><strong>Date de Naissance:</strong> {{ current_user.date_naissance.strftime('%d/%m/%Y') }}</p>
            <p><strong>Contact:</strong> {{ current_user.contact }}</p>
            <a href="{{ url_for('edit_profile') }}" class="btn btn-sm btn-outline-secondary mt-3">Modifier mes informations</a>
        </div>
    </div>

    <div class="col-md-7">
        <div class="card shadow-sm p-4 h-100">
            <h4 class="card-title text-success">Mes Prochains Rendez-vous</h4>
            
            {% if upcoming_appointments %}
            <ul class="list-group list-group-flush">
                {% for rv in upcoming_appointments %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <span class="fw-bold">{{ rv.date.strftime('%d %B %Y') }} à {{ rv.heure.strftime('%H:%M') }}</span>
                        <br>
                        Dr. {{ rv.medecin_nom }} ({{ rv.specialite }})
                    </div>
                    <span class="badge bg-primary rounded-pill">{{ rv.statut }}</span>
                    {% if rv.statut == 'Confirmé' %}
                        <form method="POST" action="{{ url_for('cancel_appointment', rv_id=rv.id) }}" class="d-inline">
                            <button type="submit" class="btn btn-danger btn-sm">Annuler</button>
                        </form>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <div class="alert alert-info">
                Vous n'avez aucun rendez-vous à venir.
            </div>
            {% endif %}
            
            <a href="{{ url_for('book_appointment') }}" class="btn btn-primary mt-3">Prendre un nouveau Rendez-vous</a>
        </div>
    </div>
</div>
{% endblock %}